{
  "name": "WAi Workflow",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "usage-report",
        "options": {}
      },
      "id": "b7f8623c-ac8b-40f9-8390-45582ed9e75b",
      "name": "Receber do Slack",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        460,
        40
      ],
      "webhookId": "webhook-pergunta-slack"
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "pergunta",
              "value": "={{ $json.body.text }}"
            },
            {
              "name": "response_url",
              "value": "={{ $json.body.response_url }}"
            },
            {
              "name": "sessionId",
              "value": "={{ $json.body.user_id || 'slack-session' }}"
            },
            {
              "name": "user_id",
              "value": "={{ $json.body.user_id  }}"
            }
          ]
        },
        "options": {}
      },
      "id": "abac1556-3b17-4000-985d-bb1389cad774",
      "name": "Preparar Dados",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        680,
        40
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId || $json.body.user_id || 'default' }}",
        "contextWindowLength": 3
      },
      "id": "f5bc269b-503a-4955-b781-6fed0b3d27f7",
      "name": "Simple Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1160,
        280
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.pergunta }}",
        "options": {
          "systemMessage": "=Hoje √© dia {{ $now }}\n\nVoc√™ √© um assistente de dados que responde perguntas com base no relat√≥rio abaixo. Seja objetivo, use dados num√©ricos quando poss√≠vel, e responda sempre em portugu√™s.\n\n# üìä Relat√≥rio Avan√ßado de An√°lise de Reservas - Woba\n\n## Dados da Empresa\n| ID | Cr√©ditos Totais | Valor do cr√©dito | Valor do cr√©dito excedente |\n|----|-----------------|------------------|----------------------------|\n|189 | 12000           | R$ 80            | R$100                      |\n\n## 1. Resumo Geral\n\n- **Total de Reservas:** 907\n- **Total de Cr√©ditos Consumidos (apenas reservas aprovadas):** 1160.65 cr√©ditos\n- **Per√≠odo Analisado:** Dados recentes, com maior volume registrado em Janeiro, Fevereiro e Mar√ßo de 2025.\n\nEsta an√°lise aprofunda o entendimento dos padr√µes de agendamento, utiliza√ß√£o de cr√©ditos, comportamento dos usu√°rios e tend√™ncias temporais, servindo de base para decis√µes estrat√©gicas e operacionais.\n\n---\n\n## 2. Distribui√ß√£o por Status de Reserva\n\n| Status                        | Quantidade | Percentual Aproximado |\n|-------------------------------|------------|-----------------------|\n| **Aprovado**                  | 769        | 84,8%                 |\n| **Cancelado pelo usu√°rio**    | 100        | 11,0%                 |\n| **Cancelado**                 | 24         | 2,6%                  |\n| **Recusado**                  | 14         | 1,5%                  |\n\n**Insights:**  \n- A alta taxa de reservas aprovadas (‚âà85%) indica um processo de agendamento eficiente.  \n- Os cancelamentos, realizados tanto pelo usu√°rio quanto pelo sistema, somam cerca de 14%, sugerindo a necessidade de analisar os motivos para minimizar desist√™ncias.\n\n---\n\n## 3. An√°lise de Check-in (Apenas Reservas Aprovadas)\n\n| Check-in | Quantidade | Percentual Aproximado |\n|----------|------------|-----------------------|\n| **Sim**  | 360        | 46,8%                 |\n| **N√£o**  | 409        | 53,2%                 |\n\n**Insights:**  \n- Menos da metade das reservas aprovadas efetivam o check-in, evidenciando uma lacuna entre o agendamento e a utiliza√ß√£o efetiva dos espa√ßos.  \n- Recomenda-se investigar os fatores que dificultam o check-in, como a comunica√ß√£o pr√©via e a facilidade do processo, para aumentar o comparecimento.\n\n---\n\n## 4. Distribui√ß√£o Geogr√°fica das Reservas (Top 5 Cidades)\n\n| Cidade                   | Reservas |\n|--------------------------|----------|\n| **S√£o Paulo/SP**         | 334      |\n| **Belo Horizonte/MG**    | 113      |\n| **Florian√≥polis/SC**     | 61       |\n| **Rio de Janeiro/RJ**    | 50       |\n| **Salvador/BA**          | 50       |\n\n**Insights:**  \n- S√£o Paulo concentra a maior quantidade de reservas, refletindo alta demanda e possivelmente maior oferta de espa√ßos.\n- A an√°lise geogr√°fica orienta estrat√©gias regionais para aloca√ß√£o de recursos e campanhas de marketing direcionadas.\n\n---\n\n## 5. An√°lise por Grupo de Usu√°rios (Top 5 Grupos)\n\n| Grupo         | Reservas |\n|---------------|----------|\n| **CS/CX**       | 135      |\n| **Supply Ops**  | 117      |\n| **Engineering** | 98       |\n| **Marketing**   | 47       |\n| **Finance**     | 35       |\n\n**Insights:**  \n- Grupos como CS/CX e Supply Ops lideram em volume, indicando necessidades espec√≠ficas que podem ser priorizadas.  \n- A segmenta√ß√£o por grupo permite a cria√ß√£o de estrat√©gias personalizadas para aumentar o engajamento de usu√°rios com menor volume de reservas.\n\n---\n\n## 6. Tipos de Espa√ßos Reservados\n\n| Tipo             | Reservas |\n|------------------|----------|\n| **Compartilhado** | 704      |\n| **Reuni√£o**       | 123      |\n| **Exclusivo**     | 64       |\n| **Eventos**       | 12       |\n\n**Insights:**  \n- O tipo \"Compartilhado\" domina o uso (‚âà77% do total), demonstrando uma forte prefer√™ncia por ambientes colaborativos.  \n- O baixo n√∫mero de reservas para \"Eventos\" pode apontar para uma demanda reprimida ou para um segmento de nicho que ainda precisa ser explorado.\n\n---\n\n## 7. Ranking de Usu√°rios com Mais Cr√©ditos Consumidos\n\n| Nome                                     | Cr√©ditos Consumidos |\n|------------------------------------------|---------------------|\n| **Felipe Mascoli**                       | 80.75               |\n| **Maria Carolina De Oliveira Melo**      | 67.00               |\n| **Paula Ladeira**                        | 46.50               |\n| **Juliana Pedroso**                      | 45.25               |\n| **Andressa Lazzeri**                     | 39.00               |\n| **Eduardo Gruber**                       | 39.00               |\n| **Caio Stanczyk**                        | 37.30               |\n| **Leonardo Tramontina**                  | 37.00               |\n| **Jean Silva**                           | 36.25               |\n| **M√°rcio Fernandes**                     | 33.05               |\n\n**Insights:**  \n- Esse ranking evidencia os principais consumidores de cr√©ditos, facilitando a cria√ß√£o de programas de fidelidade e estrat√©gias personalizadas.  \n- A an√°lise dos perfis desses usu√°rios pode orientar a oferta de benef√≠cios e a melhoria cont√≠nua dos servi√ßos.\n\n---\n\n## 8. An√°lise por Per√≠odo (Data da Reserva)\n\nUtilizando o campo **Data da reserva**, que reflete a data agendada para utiliza√ß√£o dos espa√ßos, a distribui√ß√£o mensal dos agendamentos foi a seguinte:\n\n| Per√≠odo             | Reservas Totais | Reservas Aprovadas | Cr√©ditos Consumidos (Aprovadas) |\n|---------------------|-----------------|--------------------|---------------------------------|\n| **Janeiro/2025**    | 320             | 280                | 500.00                          |\n| **Fevereiro/2025**  | 330             | 290                | 440.65                          |\n| **Mar√ßo/2025**      | 257             | 199                | 220.00                          |\n| **Total**           | 907             | 769                | 1160.65                         |\n\n**Insights:**  \n- **Janeiro/2025:** Com 320 reservas, registrou-se um forte volume inicial, com 280 reservas aprovadas e um consumo de 500 cr√©ditos, indicando alta demanda no in√≠cio do ano.  \n- **Fevereiro/2025:** Apresentou 330 reservas, das quais 290 foram aprovadas, consumindo 440.65 cr√©ditos.  \n- **Mar√ßo/2025:** Foram registradas 257 reservas, com 199 aprovadas e um consumo de 220 cr√©ditos.  \n- A an√°lise revela que a maioria das reservas se concentra nos primeiros tr√™s meses do ano, o que pode indicar um padr√£o sazonal ou influ√™ncias operacionais espec√≠ficas para esse per√≠odo.\n\n**Recomenda√ß√µes:**  \n- **Visualiza√ß√µes Temporais:** Desenvolver gr√°ficos de linha ou histogramas para monitorar a evolu√ß√£o di√°ria e semanal das reservas, identificando picos e tend√™ncias.  \n- **Ajuste de Oferta:** Alinhar a disponibilidade dos espa√ßos e os recursos operacionais com os per√≠odos de maior demanda, garantindo a otimiza√ß√£o da opera√ß√£o.  \n- **Campanhas e Comunica√ß√£o:** Planejar campanhas de marketing e lembretes direcionados para estimular reservas em per√≠odos de menor volume e incentivar a efetiva√ß√£o do check-in.\n\n---\n\n## 9. Conclus√£o\n\nEste relat√≥rio avan√ßado oferece uma vis√£o abrangente dos dados de reservas da Woba, evidenciando:\n\n- A efici√™ncia do sistema de agendamento com uma alta taxa de reservas aprovadas.\n- A necessidade de melhorias no processo de check-in para converter reservas em utiliza√ß√£o efetiva.\n- A distribui√ß√£o geogr√°fica e a segmenta√ß√£o por grupos, que permitem estrat√©gias regionais e personalizadas.\n- A predomin√¢ncia dos espa√ßos compartilhados e o perfil dos usu√°rios que mais consomem cr√©ditos.\n- Tend√™ncias temporais claras, com a maioria das reservas concentradas em Janeiro, Fevereiro e Mar√ßo de 2025.\n"
        }
      },
      "id": "a8d9530d-ab04-44f5-b80f-64bd34ff789d",
      "name": "Analista de Dados",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        940,
        40
      ],
      "alwaysOutputData": true,
      "executeOnce": false,
      "retryOnFail": false,
      "notesInFlow": false
    },
    {
      "parameters": {
        "model": {
          "value": "gpt-4o",
          "mode": "list"
        },
        "options": {}
      },
      "id": "5f368b30-391b-4634-88ad-8a03af0f225b",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        980,
        280
      ],
      "credentials": {
        "openAiApi": {
          "id": "A7CBOA3izWSsa9LD",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "={{ $json.response_url }}",
        "jsonParameters": true,
        "options": {
          "bodyContentType": "raw"
        },
        "bodyParametersJson": "={\n  \"text\": \"{{ $json.output || 'Sem resposta.' }}\",\n  \"response_type\": \"ephemeral\"\n}"
      },
      "id": "8a4ba789-faec-442f-bb2c-2e361f11d498",
      "name": "Responder no Slack",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        1660,
        -140
      ]
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {
          "includeUnpaired": true
        }
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        1260,
        -140
      ],
      "id": "ed5c0a6b-7f4c-4d6e-a5fc-9ee9b29803e7",
      "name": "Merge",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "const url = $input.first().json.response_url\nconst formated_text = $input.first().json.output.replace(/\\\\n/g, '\\n')\n\nconsole.log($input.first().json.output);\n\nreturn [\n  {\n    json: {\n      response_url: url,\n      output: formated_text\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1460,
        -140
      ],
      "id": "8913222c-3098-4457-9caa-79de12846c82",
      "name": "Code"
    }
  ],
  "pinData": {},
  "connections": {
    "Receber do Slack": {
      "main": [
        [
          {
            "node": "Preparar Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "Analista de Dados",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Analista de Dados": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Analista de Dados",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Preparar Dados": {
      "main": [
        [
          {
            "node": "Analista de Dados",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Responder no Slack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Responder no Slack": {
      "main": [
        []
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "c0588d2b-6fea-46f7-abbf-08b066063822",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "499ab5a93cffbd1bd523352e296515b05cebf4f71e67381ca94a0d315ee131fa"
  },
  "id": "pGUBQ8uGyEQcVuAm",
  "tags": []
}